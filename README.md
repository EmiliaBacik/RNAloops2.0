# RNAloops engine

## REQUIREMENTS
Basic requirements:
    Python >= 3.6
    Updated pip

To install python we recommend using one of the Python distribution available on https://www.python.org/. The installation process is nicely described od https://realpython.com/installing-python/.

pip is already installed if you are using Python 2 >=2.7.9 or Python 3 >=3.4 downloaded from python.org. To update it depending on you OS you can use

On Linux or macOS:
    pip install -U pip

On Windows:
    python -m pip install -U pip

With installed pip and Python you can install required packages available in the requirements.txt file. You can do this by using pip:
    pip install -r requirements.txt
    
Be aware that if you have installed more that one Python version it may be needed to adjust PATH local variable in Windows or use i.e. python3.8 - m pip install -U pip. This is applicable to all pip commands.


## File preparation
As an input script requires file containing structure's 2D representation using dot-bracket structure. File with dot-bracket notation representation can be generated by using the RNApdbee (http://rnapdbee.cs.put.poznan.pl/). The RNApdbee allows users to generate dot-bracket files from both 3D and 2D structure representation.
For dot-bracket file a naming convention needs to be followed. It has to start with PDB_ID and be separated by dash (-) from the rest of the filename (i.e. 1E8O-mycomment.txt).

#### Usage example

Before running, user have to set up config file. As a default we have 2 params: 
    *mode (set to multiple),
    *path_to_dotbracket_files (by default set to ./dotbracket_files/test_multiple/).
In ./dotbracket_files/test_multiple/ folder is placed a dot-bracket structure generated for 1b23, 1E8O, 1GRZ by RNApdbee (http://rnapdbee.cs.put.poznan.pl/) that can be use as an examples.
1E8O contains a 3-way junction.
1B23 contains a 4-way junction.
1GRZ contains 4 different 3-way junctions.

To run use: 
python main.py command.

After running, in ./output folder program generates RESULT.xml file and folder /structures with 3D structures of the found n-way junctions.

## Short Workflow description

As an input tool uses a file with the dot-bracket representation of the structure (to get this file from the 3D structure you can use RNApdbee).

Based on the dot-bracket notation algorithm finds an n-way junction. In the next step, the algorithm looks for PDB file in folder, if the file does not exist the structure is retrieved automatically and saved in the mentioned folder. For identified junctions based on 3D structure algorithm represents outgoing stems as a vector in 3D space and for pairs of stems calculates the value of planar angle and Euler angles. The final step is the generation of RESULT.xml file that contains all results.

## Running tests 

To run all implemented tests while being in project directory use:

python -m unittest discover ./tests/

# Topology Search

Mechanism for searching n-way junction RNA with a specific topology in the **RNAloops** application. These scripts process a CSV file containing the results of RNA loop searches and enable the identification of loops with a specific topology in the **RNAloops** application.

## Examples of RNA multiloop topologies

The table below shows examples of topologies and the corresponding secondary structures of RNA multi-loops.

| PDB ID | Secondary Structure | Multiloop Type | Topology |
|--------|-------------------|----------------|----------|
| 5WFS   | (.(((-)))...(((-)))..) | 3-way junction | 1-3-2 |
| 1BAU   | (...[-[..)-(...]-]..)  | 4-way junction | 3-2-3-2 |
| 4P6F   | ([-[...(-(.]-])-))     | 5-way junction | 0-3-1-0-0 |

## Components

- **filter.py** – Python script that searches the input dataset for loops with a user-defined topology in the `"X-X-X"` format (where `"X"` represents the number of unpaired nucleotides in a given single-stranded fragment of the loop).

- **process.sh** – Bash script that supplements the filtered loops with **resolution** and **experimental method** information obtained from the **PDB** repository.

- **select.py** – Python script that groups the provided data based on the secondary structure (represented in **extended dot-bracket notation**) and selects a representative loop of the highest quality for each unique secondary structure.

## Usage example

Run the following commands in order to process RNA loop search results:

```bash
python3 filter.py -vtopol="4-1-5-2" < Search_results.csv > filter.csv
```
Filters loops with the specified topology ("4-1-5-2") from the input CSV file.
```bash
./process.sh  filter.csv > process.csv
```
Adds additional information from the PDB (resolution and experimental method) to the filtered loops.
```bash
python3 select.py < process.csv > select_output.csv
```
Selects representative loops for each unique secondary structure, producing the final CSV file.


